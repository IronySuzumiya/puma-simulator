# Defines all the components needed by a node
# Tile, Network-on-Chip (NOC)

import sys
sys.path.insert (0, '/home/ankitaay/dpe/include')
import constants as param

# define an noc class - deals with data transfers between tiles
# 1. send_queue in each tile is a prt of noc
# 2. noc class here does the decoding part
class noc (object):

    def __init__ (self):
        # define num_access (both inter and intra node)
        self.num_access_intra = 0
        self.num_access_inter = 0

        # define latency
        self.latency_intra = param.noc_latency_intranode
        self.latency_inter = param.noc_latency_internode

    def getLatency (self, target_addr):
        # Need to FIX this - MSB of node_addr would be 1 fro internode transfer
        inter_flag = target_addr[0]
        if (inter_flag == 1):
            return self.latency_inter
        return self.latency_intra

    def propagate (self, target_addr):
        inter_flag = target_addr[0]
        if (inter_flag == 1):
            self.num_access_inter += 1
        else:
            self.num_access_intra += 1

        assert ((type(target_addr) == str) and \
                (len(target_addr) == param.num_bits_tileId + param.num_bits_nodeId)), \
                'target addr is invalid - check format and length'
        node_addr = int (target_addr[0:param.num_bits_nodeId], 2)
        tile_addr = int (target_addr[param.num_bits_nodeId:], 2)
        return [node_addr, tile_addr]

